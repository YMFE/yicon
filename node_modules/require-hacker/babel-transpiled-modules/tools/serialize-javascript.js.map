{"version":3,"sources":["../../source/tools/serialize-javascript.js"],"names":[],"mappings":"AAAA;;;;;;AAMA;;;;;;;;AAEA,IAAI,OAAO,QAAQ,MAAR,CAAX;;AAEA,OAAO,OAAP,GAAiB,SAAjB;;AAEA,IAAI,uBAAuB,4BAA3B;AAAA,IACI,qBAAuB,kCAD3B;AAAA,IAEI,qBAAuB,qBAF3B;;AAIA;AACA;AACA,IAAI,gBAAgB;AAChB,SAAU,SADM;AAEhB,SAAU,SAFM;AAGhB,SAAU,SAHM;AAIhB,cAAU,SAJM;AAKhB,cAAU;AALM,CAApB;;AAQA,SAAS,SAAT,CAAmB,GAAnB,EAAwB;AACpB,QAAI,YAAY,EAAhB;AAAA,QACI,UAAY,EADhB;AAAA,QAEI,GAFJ;;AAIA;AACA;AACA;AACA,UAAM,yBAAe,GAAf,EAAoB,UAAU,GAAV,EAAe,KAAf,EAAsB;AAC5C,YAAI,OAAO,KAAP,KAAiB,UAArB,EAAiC;AAC7B,mBAAO,kBAAkB,UAAU,IAAV,CAAe,KAAf,IAAwB,CAA1C,IAA+C,KAAtD;AACH;;AAED,YAAI,KAAK,QAAL,CAAc,KAAd,CAAJ,EAA0B;AACtB,mBAAO,gBAAgB,QAAQ,IAAR,CAAa,KAAb,IAAsB,CAAtC,IAA2C,KAAlD;AACH;;AAED,eAAO,KAAP;AACH,KAVK,CAAN;;AAYA;AACA;AACA,QAAI,OAAO,GAAP,KAAe,QAAnB,EAA6B;AACzB,eAAO,OAAO,GAAP,CAAP;AACH;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAI,EAAE,UAAU,MAAV,IAAoB,QAAQ,MAA9B,CAAJ,EAA2C;AACvC,eAAO,GAAP;AACH;;AAED;AACA;AACA;AACA,WAAO,IAAI,OAAJ,CAAY,kBAAZ,EAAgC,UAAU,KAAV,EAAiB,IAAjB,EAAuB,KAAvB,EAA8B;AACjE,YAAI,SAAS,QAAb,EAAuB;AACnB,mBAAO,QAAQ,KAAR,EAAe,QAAf,EAAP;AACH;;AAED,YAAI,KAAe,UAAU,KAAV,CAAnB;AAAA,YACI,eAAe,GAAG,QAAH,EADnB;;AAGA,YAAI,qBAAqB,IAArB,CAA0B,YAA1B,CAAJ,EAA6C;AACzC,kBAAM,IAAI,SAAJ,CAAc,kCAAkC,GAAG,IAAnD,CAAN;AACH;;AAED,eAAO,YAAP;AACH,KAbM,CAAP;AAcH","file":"serialize-javascript.js","sourcesContent":["/*\r\nCopyright (c) 2014, Yahoo! Inc. All rights reserved.\r\nCopyrights licensed under the New BSD License.\r\nSee the accompanying LICENSE file for terms.\r\n*/\r\n\r\n'use strict';\r\n\r\nvar util = require('util');\r\n\r\nmodule.exports = serialize;\r\n\r\nvar IS_NATIVE_CODE_REGEX = /\\{\\s*\\[native code\\]\\s*\\}/g,\r\n    PLACE_HOLDER_REGEX   = /\"@__(FUNCTION|REGEXP)_(\\d+)__@\"/g,\r\n    UNSAFE_CHARS_REGEX   = /[<>\\/\\u2028\\u2029]/g;\r\n\r\n// Mapping of unsafe HTML and invalid JavaScript line terminator chars to their\r\n// Unicode char counterparts which are safe to use in JavaScript strings.\r\nvar UNICODE_CHARS = {\r\n    '<'     : '\\\\u003C',\r\n    '>'     : '\\\\u003E',\r\n    '/'     : '\\\\u002F',\r\n    '\\u2028': '\\\\u2028',\r\n    '\\u2029': '\\\\u2029'\r\n};\r\n\r\nfunction serialize(obj) {\r\n    var functions = [],\r\n        regexps   = [],\r\n        str;\r\n\r\n    // Creates a JSON string representation of the object and uses placeholders\r\n    // for functions and regexps (identified by index) which are later\r\n    // replaced.\r\n    str = JSON.stringify(obj, function (key, value) {\r\n        if (typeof value === 'function') {\r\n            return '@__FUNCTION_' + (functions.push(value) - 1) + '__@';\r\n        }\r\n\r\n        if (util.isRegExp(value)) {\r\n            return '@__REGEXP_' + (regexps.push(value) - 1) + '__@';\r\n        }\r\n\r\n        return value;\r\n    });\r\n\r\n    // Protects against `JSON.stringify()` returning `undefined`, by serializing\r\n    // to the literal string: \"undefined\".\r\n    if (typeof str !== 'string') {\r\n        return String(str);\r\n    }\r\n\r\n    // // Replace unsafe HTML and invalid JavaScript line terminator chars with\r\n    // // their safe Unicode char counterpart. This _must_ happen before the\r\n    // // regexps and functions are serialized and added back to the string.\r\n    // str = str.replace(UNSAFE_CHARS_REGEX, function (unsafeChar) {\r\n    //     return UNICODE_CHARS[unsafeChar];\r\n    // });\r\n\r\n    if (!(functions.length || regexps.length)) {\r\n        return str;\r\n    }\r\n\r\n    // Replaces all occurrences of function and regexp placeholders in the JSON\r\n    // string with their string representations. If the original value can not\r\n    // be found, then `undefined` is used.\r\n    return str.replace(PLACE_HOLDER_REGEX, function (match, type, index) {\r\n        if (type === 'REGEXP') {\r\n            return regexps[index].toString();\r\n        }\r\n\r\n        var fn           = functions[index],\r\n            serializedFn = fn.toString();\r\n\r\n        if (IS_NATIVE_CODE_REGEX.test(serializedFn)) {\r\n            throw new TypeError('Serializing native function: ' + fn.name);\r\n        }\r\n\r\n        return serializedFn;\r\n    });\r\n}"]}